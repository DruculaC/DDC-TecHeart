C51 COMPILER V9.51   VOICE                                                                 03/16/2015 15:12:36 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE VOICE
OBJECT MODULE PLACED IN .\voice.obj
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE ..\Library\voice.c COMPACT BROWSE INCDIR(..\Library) DE
                    -BUG OBJECTEXTEND PRINT(.\voice.lst) TABS(3) OBJECT(.\voice.obj)

line level    source

   1          /*---------------------------------------------------
   2             voice.c (v1.00)
   3             通用语音文件
   4          ---------------------------------------------------*/
   5          
   6          #include "main.h"
   7          #include "port.h"
   8          
   9          #include "voice.h"
  10          #include "Delay.h"
  11          #include "communication.h"
  12          
  13          /*------ private variable --------------------------*/
  14          tByte key_rotate_on_speech_number = 1;    // 循环报两段开机语音
  15          
  16          extern bit flashing_flag;
  17             
  18          /*--------------------------------------------------
  19             SC_Speech()
  20             按段数发送脉冲，即可报第几段语音。
  21          ---------------------------------------------------*/
  22          void SC_Speech(tByte cnt)
  23             {
  24   1         tByte ii;
  25   1         SC_RST = 0;
  26   1      // delay_ms(100);
  27   1         Delay_50ms();
  28   1         SC_RST = 1;
  29   1      // delay_ms(150);
  30   1         Delay_50ms();
  31   1         for(ii=0; ii < cnt; ii++)
  32   1            {
  33   2            SC_DATA = 1; 
  34   2            delay_us(20);
  35   2            SC_DATA = 0; 
  36   2            delay_us(20);
  37   2            }
  38   1         }
  39          
  40          /*-------------------------------------------------
  41             noVoice()
  42             在上电的时候调用，屏蔽语音的误报
  43          --------------------------------------------------*/
  44          void noVoice()
  45             {
  46   1         P14=0;
  47   1         SC_DATA = 0;
  48   1         SC_RST = 0;
  49   1         delay_us(350); 
  50   1         SC_RST = 1;
  51   1         delay_us(350);
  52   1         P14 = 1;
  53   1         }
  54          
C51 COMPILER V9.51   VOICE                                                                 03/16/2015 15:12:36 PAGE 2   

  55          /*----------------------------------------------------
  56             key_rotate_on_speech()
  57             钥匙旋转至ON后，语音提示
  58          -----------------------------------------------------*/
  59          void key_rotate_on_speech(void)
  60             {
  61   1         switch(key_rotate_on_speech_number)
  62   1            {
  63   2            case 1:
  64   2               {
  65   3               voice_EN = 1;
  66   3               SC_Speech(26);  
  67   3               Delay(100);
  68   3               voice_EN = 0;
  69   3               key_rotate_on_speech_number = 1;
  70   3               }
  71   2            break;
  72   2            
  73   2            case 2:
  74   2               {
  75   3               voice_EN = 1;
  76   3               SC_Speech(14);  
  77   3               Delay(40);
  78   3               SC_Speech(12);  
  79   3               Delay(60);
  80   3               voice_EN = 0;
  81   3               key_rotate_on_speech_number = 1;       
  82   3               }
  83   2            break;
  84   2            }
  85   1         }
  86             
  87          /*-----------------------------------------------------
  88             key_rotate_off_speech()
  89             钥匙旋转到OFF后，语音提示
  90          void key_rotate_off_speech(void)
  91             {
  92             voice_EN = 1;
  93             SC_Speech(13);
  94             Delay(40);
  95             voice_EN = 0;
  96             }
  97          ------------------------------------------------------*/
  98          
  99          /*----------------------------------------------------
 100             motorBAT_low_speech()
 101             主机电瓶电量低于最小限定值，语音提示电量不足。
 102          -----------------------------------------------------*/
 103          void motorBAT_low_speech(void)
 104             {
 105   1         voice_EN = 1;
 106   1         SC_Speech(4);
 107   1         Delay(80);
 108   1         voice_EN = 0;
 109   1         }
 110          
 111          /*----------------------------------------------------
 112             ID_speech()
 113             第一次碰主机，会有一句提示语音
 114          --------------------------------------------------------*/
 115          void ID_speech(void)
 116             {
C51 COMPILER V9.51   VOICE                                                                 03/16/2015 15:12:36 PAGE 3   

 117   1         voice_EN = 1;
 118   1         SC_Speech(24); 
 119   1         Delay(30);
 120   1         voice_EN = 0;
 121   1         }
 122          
 123          /*----------------------------------------------------
 124             Self_learn_speech()
 125             第一次碰主机，会有一句提示语音
 126          --------------------------------------------------------*/
 127          void Self_learn_speech(void)
 128             {
 129   1         voice_EN = 1;
 130   1         SC_Speech(25); 
 131   1         Delay(30);
 132   1         voice_EN = 0;
 133   1         flashing_flag = 0;
 134   1         }
 135          
 136          /*----------------------------------------------------
 137             host_touch_speech()
 138             第一次碰主机，会有一句提示语音
 139          --------------------------------------------------------*/
 140          void host_touch_speech(void)
 141             {
 142   1         voice_EN = 1;
 143   1         SC_Speech(2);  
 144   1         Delay(90);
 145   1         voice_EN = 0;
 146   1         Delay(30);
 147   1         }
 148          
 149          /*-----------------------------------------------------
 150             host_2ndtouch_speech()
 151             第二次触碰主机，再报一个提示语音
 152          -------------------------------------------------------*/
 153          void host_2ndtouch_speech(void)
 154             {
 155   1         voice_EN = 1;
 156   1         SC_Speech(17);  
 157   1         Delay(140);
 158   1         voice_EN = 0;
 159   1      // Delay(10);
 160   1         }
 161             
 162          /*----------------------------------------------------
 163             stolen_alarm_speech()
 164             判断为被盗的时候，发出报警语音第一段
 165          ----------------------------------------------------*/
 166          void stolen_alarm_speech1(void)
 167             {
 168   1         voice_EN = 1;
 169   1         SC_Speech(14); 
 170   1         Delay(80);
 171   1         voice_EN = 0; 
 172   1         }
 173          
 174          /*----------------------------------------------------
 175             stolen_alarm_speech()
 176             判断为被盗的时候，发出报警语音第二段
 177          ----------------------------------------------------*/
 178           void stolen_alarm_speech2(void)
C51 COMPILER V9.51   VOICE                                                                 03/16/2015 15:12:36 PAGE 4   

 179             {
 180   1         voice_EN = 1;
 181   1         SC_Speech(3); 
 182   1         Delay(180);
 183   1         voice_EN = 0;
 184   1         Delay(20);
 185   1         }
 186          
 187          /*----------------------------------------------------
 188             open_lock_speech()
 189             附机在主机附近，通过认证后，语音提示
 190          -----------------------------------------------------*/
 191          void open_lock_speech(void)
 192             {
 193   1         voice_EN=1;
 194   1         SC_Speech(15); 
 195   1         Delay(60);
 196   1         voice_EN=0;
 197   1         }
 198          
 199          /*----------------------------------------------------
 200             close_lock_speech()
 201             判断附机离开，语音提示
 202          -----------------------------------------------------*/
 203          void close_lock_speech(void)
 204             {
 205   1         voice_EN = 1;
 206   1         SC_Speech(16);  
 207   1         Delay(60);
 208   1         voice_EN = 0;
 209   1         }
 210          
 211          /*----------------------------------------------------
 212             battery_stolen_speech()
 213             主机检测到电平不在时，语音提示电平被盗
 214          -----------------------------------------------------*/
 215          void battery_stolen_speech(void)
 216             {
 217   1         voice_EN = 1;
 218   1         SC_Speech(13);  
 219   1         Delay(100);
 220   1         voice_EN = 0;
 221   1         }
 222          
 223          /*----------------------------------------------------
 224             Cutting_Wire_Voice()
 225             有人剪断锁线的时候，播报的语音
 226          -----------------------------------------------------*/
 227          void Cutting_Wire_Voice(void)
 228             {
 229   1         voice_EN = 1;
 230   1         SC_Speech(20);  
 231   1         Delay(120);
 232   1         voice_EN = 0;
 233   1         }
 234          
 235          /*----------------------------------------------------
 236             Product_Test_Voice()
 237             测试程序中的语音提示
 238          -----------------------------------------------------*/
 239          void Product_Test_Voice(void)
 240             {
C51 COMPILER V9.51   VOICE                                                                 03/16/2015 15:12:36 PAGE 5   

 241   1         voice_EN = 1;
 242   1         SC_Speech(19);  
 243   1         Delay(150);
 244   1         voice_EN = 0;
 245   1         }
 246          
 247          /*---------------------------------------------------------------
 248             Battery_low_alarm_speech()
 249             用于附机，当电池电量低于一定值，语音提示
 250          ----------------------------------------------------------------*/
 251          void Battery_low_alarm_speech(void)
 252             {
 253   1         voice_EN = 1;
 254   1         SC_Speech(9);
 255   1         Delay(80);
 256   1         voice_EN = 0;
 257   1         }
 258          
 259          /*---------------------------------------------------------------
 260             Battery_high_alarm_speech()
 261             用于附机，电量高于一定值的时候，语音提示
 262          ----------------------------------------------------------------*/
 263          void Battery_high_alarm_speech(void)
 264             {
 265   1         voice_EN = 1;
 266   1         SC_Speech(7);
 267   1         Delay(50);
 268   1         voice_EN = 0;
 269   1         }
 270          
 271          /*-------------------------------------------------------------
 272             Alarm_stolen_speech()
 273             用于附机，主机被盗报警
 274          ---------------------------------------------------------------*/
 275          void Alarm_stolen_speech(void)
 276             {
 277   1         voice_EN = 1;
 278   1         SC_Speech(5);
 279   1         Delay(150);
 280   1         voice_EN = 0;
 281   1         }
 282             
 283          /*--------------------------------------------------------------
 284             Alarm_raised_speech()
 285             用于附机，主机被抬起报警
 286          ---------------------------------------------------------------*/
 287          void Alarm_raised_speech(void)
 288             {
 289   1         voice_EN = 1;
 290   1         SC_Speech(3);
 291   1         Delay(140);
 292   1         voice_EN = 0;
 293   1         }
 294             
 295          /*--------------------------------------------------------------
 296             Alarm_fell_speech()
 297             用于附机，主机倒地报警
 298          ----------------------------------------------------------------*/
 299          void Alarm_fell_speech(void)
 300             {
 301   1         voice_EN = 1;
 302   1         SC_Speech(2);
C51 COMPILER V9.51   VOICE                                                                 03/16/2015 15:12:36 PAGE 6   

 303   1         Delay(120);
 304   1         voice_EN = 0;
 305   1         }
 306             
 307          /*---------------------------------------------------------------
 308             Host_battery_high_alarm_speech()
 309             用于附机，主机电量充满提示
 310          ---------------------------------------------------------------*/
 311          void Host_battery_high_alarm_speech(void)
 312             {
 313   1         voice_EN = 1;
 314   1         SC_Speech(7);  
 315   1         Delay(80);
 316   1         voice_EN = 0;
 317   1         }
 318          
 319          /*---------------------------------------------------------------
 320             battery_stolen_speech_F3()
 321             用于附机，主机电池被盗报警
 322          ---------------------------------------------------------------*/
 323          void battery_stolen_speech_F3(void)
 324             {
 325   1         voice_EN = 1;
 326   1         SC_Speech(11);  
 327   1         Delay(50);
 328   1         voice_EN = 0;
 329   1         }
 330             
 331          /*---------------------------------------------------------------
 332             wire_broken_speech(void)
 333             用于附机，主机锁线被剪断报警
 334          ----------------------------------------------------------------*/
 335          void wire_broken_speech(void)
 336             {
 337   1         voice_EN = 1;
 338   1         SC_Speech(15);  
 339   1         Delay(80);
 340   1         voice_EN = 0;  
 341   1         }
 342          
 343          /*---------------------------------------------------------------
 344             lock_rotated_on_speech(void)
 345             用于附机，主机锁线被剪断报警
 346          ----------------------------------------------------------------*/
 347          void lock_rotated_on_speech(void)
 348             {
 349   1         voice_EN = 1;
 350   1         SC_Speech(12);  
 351   1         Delay(80);
 352   1         voice_EN = 0;  
 353   1         }
 354          /*---------------------------------------------------------------
 355             lock_rotated_off_speech(void)
 356             用于附机，主机锁线被剪断报警
 357          ----------------------------------------------------------------*/
 358          void lock_rotated_off_speech(void)
 359             {
 360   1         voice_EN = 1;
 361   1         SC_Speech(13);  
 362   1         Delay(80);
 363   1         voice_EN = 0;  
 364   1         }
C51 COMPILER V9.51   VOICE                                                                 03/16/2015 15:12:36 PAGE 7   

 365          
 366          /*---------------------------------------------------
 367             end of file
 368          ----------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    470    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      1       2
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
